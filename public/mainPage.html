<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baywatch</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" type="image/png" href="baywatch.png">
</head>
<body>
   <h1>Baywatch</h1>

   <button type="button" onclick="logout()">Logout</button>
   <nav class="navbar">
        <ul>
            <li><a href="frontPage.html">Front Page</a></li>
            <li><a href="mainPage.html">Main Page</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="createAccount.html">Create Account</a></li>
            <li><a href="sources.html">Sources</a></li>
            <li><a href="subscription.html">Subscription Page</a></li>
            <li><a href="additional_info.html">Additional Information</a></li>
            <li><a href="feedback.html">Feedback Page</a></li>
        </ul>
    </nav>

    <main>
        <p id="username"></p>
        <h3>This is the main page</h3>
        <select name="Locations" id="locationList">
        </select>

        <button type="button" onclick="getLocationData()">Select a location</button>
        
        <ul id="locationData">

        </ul>

        <p>Functionality go here</p>
    </main>

    <gmp-map
        center="37.8, -76.0"
        zoom="9"
        map-id="ChesapeakeBayMap"
        style="height: 650px"
    ></gmp-map>

    <div id="map" style="height: 450px; width: 100%; margin-top: 20px;"></div>

    <script src = "geolocation.js"></script>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDW6ceKFbiKTwBicjVJcTPeloYefjkc1KY&loading=async&libraries=maps,marker&v=beta"
        defer>
    </script>
    <script>
        fetch('/main')
        .then(response => response.json())
        .then(data => {
            var locationSelect = document.getElementById('locationList')
            data.forEach(element => {
                var newOption = document.createElement('option')
                newOption.value = element.locationName
                newOption.textContent = element.locationName
                locationSelect.appendChild(newOption)
            })
        })
        function getLocationData(){
            var selectedLocation = document.getElementById('locationList')
            var locationDataList = document.getElementById('locationData')
            var value = selectedLocation.value
            fetch(`/locationData/${value}`)
            .then(response => response.json())
            .then(data => {

                locationDataList.innerHTML = ""

                var node = document.createElement('li')
                var text = document.createTextNode('Animal Life: ' +data[0].animalLife)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('Runoff: ' + data[0].runoff)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('DeadZones: ' + data[0].deadZones)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('Chemical Pollution: ' +data[0].chemicalPollution)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('Climate Change: '+data[0].climateChange)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('Invasive Species: ' + data[0].invasiveSpecies)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('Air Pollution: ' +data[0].airPollution)

                node.appendChild(text)
                locationDataList.appendChild(node)

                node = document.createElement('li')
                text = document.createTextNode('Wastewater: ' +data[0].wastewater)

                node.appendChild(text)
                locationDataList.appendChild(node)

            })
        }
        function logout(){
            window.location.href = '/'
        }
    </script>
</body>
</html>
